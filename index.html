// SIGNUP FUNCTION - FIXED TO SAVE TO BOTH AUTH AND DATA
function signup() {
    const email = document.getElementById('signupEmail').value;
    const password = document.getElementById('signupPassword').value;
    const confirmPass = document.getElementById('confirmPassword').value;
    const firstName = document.getElementById('firstName').value;
    const lastName = document.getElementById('lastName').value;
    const middleName = document.getElementById('middleName').value;
    const dob = document.getElementById('dob').value;
    const phone = document.getElementById('phone').value;
    const address = document.getElementById('address').value;
    const city = document.getElementById('city').value;
    const state = document.getElementById('state').value;
    const country = document.getElementById('country').value;
    const postalCode = document.getElementById('postalCode').value;
    const occupation = document.getElementById('occupation').value;
    const experience = document.getElementById('experience').value;

    // Validate required fields
    if (!firstName || !lastName || !email || !password || !confirmPass || !dob || !phone || !address || !city || !state || !country || !postalCode || !occupation) {
        alert('Please fill in all required fields');
        return;
    }

    if (password !== confirmPass) {
        alert('Passwords do not match');
        return;
    }

    if (password.length < 6) {
        alert('Password must be at least 6 characters');
        return;
    }

    // Show loading message
    alert('Creating account...');

    // Create user in AUTHENTICATION
    auth.createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
            // Send email verification
            return userCredential.user.sendEmailVerification()
                .then(() => {
                    // Save user data to DATA - THIS WAS MISSING!
                    return db.collection('users').doc(userCredential.user.uid).set({
                        firstName: firstName,
                        middleName: middleName || '',
                        lastName: lastName,
                        fullName: firstName + ' ' + (middleName ? middleName + ' ' : '') + lastName,
                        email: email,
                        phone: phone,
                        dateOfBirth: dob,
                        address: address,
                        city: city,
                        state: state,
                        country: country,
                        postalCode: postalCode,
                        occupation: occupation,
                        experience: experience,
                        role: 'user',
                        subscription: 'inactive',
                        emailVerified: false,
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString(),
                        balance: 0,
                        available: 0,
                        totalTrades: 0,
                        winRate: 0,
                        totalPips: 0
                    });
                });
        })
        .then(() => {
            alert('✅ Account created! Please check your email for verification.');
            document.getElementById('verifiedEmail').textContent = email;
            document.getElementById('signupForm').classList.remove('active');
            document.getElementById('verificationNotice').classList.add('active');
        })
        .catch((error) => {
            alert('❌ Error: ' + error.message);
        });
}
